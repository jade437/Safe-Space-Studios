<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Justice Ally Finder - SafeSpace Studio</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        :root {
            --primary-color: #6C63FF;
            --primary-light: #6C63FF1A;
            --secondary-color: #FF6584;
            --success-color: #4CAF50;
            --warning-color: #FF9800;
            --danger-color: #F44336;
            --text-color: #333333;
            --text-light: #666666;
            --bg-color: #F9F9FF;
            --card-bg: #FFFFFF;
            --border-color: #E0E0E0;
            --shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            --radius: 12px;
            --transition: all 0.3s ease;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            line-height: 1.6;
        }

        .trauma-informed {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }

        /* Emergency Exit */
        .emergency-exit {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
        }

        .btn-emergency {
            background-color: var(--danger-color);
            color: white;
            padding: 10px 15px;
            border-radius: 50px;
            text-decoration: none;
            font-weight: 600;
            box-shadow: var(--shadow);
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .btn-emergency:hover {
            background-color: #d32f2f;
            transform: translateY(-2px);
        }

        /* Header */
        .app-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 20px 0;
            margin-bottom: 20px;
        }

        .menu-toggle {
            background: none;
            border: none;
            cursor: pointer;
            display: flex;
            flex-direction: column;
            gap: 4px;
            padding: 5px;
        }

        .menu-toggle span {
            width: 25px;
            height: 3px;
            background-color: var(--primary-color);
            border-radius: 2px;
            transition: var(--transition);
        }

        .app-header h1 {
            font-size: 2rem;
            color: var(--primary-color);
            font-weight: 700;
        }

        .user-actions {
            display: flex;
            gap: 10px;
        }

        .btn-icon {
            background: none;
            border: none;
            color: var(--primary-color);
            font-size: 1.2rem;
            cursor: pointer;
            padding: 8px;
            border-radius: 50%;
            transition: var(--transition);
        }

        .btn-icon:hover {
            background-color: var(--primary-light);
        }

        /* Navigation */
        .main-nav {
            position: fixed;
            top: 0;
            left: -280px;
            width: 280px;
            height: 100vh;
            background-color: var(--card-bg);
            box-shadow: var(--shadow);
            padding: 20px;
            transition: var(--transition);
            z-index: 900;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }

        .main-nav.active {
            left: 0;
        }

        .main-nav ul {
            list-style: none;
            margin-top: 40px;
        }

        .main-nav li {
            margin-bottom: 10px;
        }

        .main-nav a {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 15px;
            text-decoration: none;
            color: var(--text-color);
            border-radius: var(--radius);
            transition: var(--transition);
        }

        .main-nav a:hover, .main-nav li.active a {
            background-color: var(--primary-light);
            color: var(--primary-color);
        }

        .nav-footer {
            border-top: 1px solid var(--border-color);
            padding-top: 20px;
        }

        .btn-secondary {
            background-color: var(--card-bg);
            color: var(--primary-color);
            border: 1px solid var(--primary-color);
            padding: 10px 15px;
            border-radius: var(--radius);
            cursor: pointer;
            font-weight: 600;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 8px;
            width: 100%;
            justify-content: center;
            margin-bottom: 15px;
        }

        .btn-secondary:hover {
            background-color: var(--primary-light);
        }

        .connection-status {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.9rem;
            color: var(--text-light);
        }

        .status-indicator {
            width: 10px;
            height: 10px;
            border-radius: 50%;
        }

        .status-indicator.online {
            background-color: var(--success-color);
        }

        /* Main Content */
        .justice-container {
            padding-bottom: 40px;
        }

        section {
            background-color: var(--card-bg);
            border-radius: var(--radius);
            padding: 25px;
            margin-bottom: 25px;
            box-shadow: var(--shadow);
        }

        h2, h3, h4 {
            color: var(--primary-color);
            margin-bottom: 15px;
        }

        h2 {
            font-size: 1.8rem;
        }

        h3 {
            font-size: 1.4rem;
        }

        h4 {
            font-size: 1.2rem;
        }

        .justice-description {
            color: var(--text-light);
            margin-bottom: 20px;
        }

        /* Safety Notice */
        .safety-notice {
            display: flex;
            align-items: center;
            gap: 15px;
            background-color: var(--primary-light);
            padding: 15px;
            border-radius: var(--radius);
            margin-top: 20px;
        }

        .safety-notice i {
            color: var(--primary-color);
            font-size: 1.5rem;
        }

        /* Search Card */
        .search-card {
            padding: 25px;
            border-radius: var(--radius);
            background-color: var(--primary-light);
        }

        .search-filters {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .filter-group {
            display: flex;
            flex-direction: column;
        }

        label {
            margin-bottom: 8px;
            font-weight: 600;
        }

        select {
            padding: 12px 15px;
            border: 1px solid var(--border-color);
            border-radius: var(--radius);
            font-family: inherit;
            font-size: 1rem;
            transition: var(--transition);
        }

        select:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 2px var(--primary-light);
        }

        .search-actions {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }

        .btn-primary {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: var(--radius);
            cursor: pointer;
            font-weight: 600;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary:hover {
            background-color: #5a52e0;
            transform: translateY(-2px);
        }

        /* Results */
        .results-count {
            color: var(--text-light);
            margin-bottom: 20px;
        }

        .result-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .ally-card {
            border: 1px solid var(--border-color);
            border-radius: var(--radius);
            padding: 20px;
            transition: var(--transition);
            display: flex;
            flex-direction: column;
        }

        .ally-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow);
        }

        .ally-header {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
        }

        .ally-photo {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background-color: var(--primary-light);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--primary-color);
            font-size: 1.5rem;
        }

        .ally-details {
            flex: 1;
        }

        .ally-specialty {
            color: var(--text-light);
            margin-bottom: 10px;
        }

        .ally-location, .ally-languages, .ally-rating {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 8px;
            font-size: 0.9rem;
        }

        .language-tag {
            background-color: var(--primary-light);
            color: var(--primary-color);
            padding: 4px 8px;
            border-radius: 20px;
            font-size: 0.8rem;
        }

        .stars {
            color: #FFC107;
        }

        .review-count {
            color: var(--text-light);
            margin-left: 8px;
        }

        .ally-actions {
            display: flex;
            gap: 10px;
            margin-top: auto;
        }

        .btn-small {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: var(--radius);
            cursor: pointer;
            font-weight: 600;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.9rem;
        }

        .btn-small:hover {
            background-color: #5a52e0;
        }

        .result-actions {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
        }

        .btn-text {
            background: none;
            border: none;
            color: var(--primary-color);
            cursor: pointer;
            font-weight: 600;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .btn-text:hover {
            color: #5a52e0;
        }

        /* Resources */
        .resource-cards {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
        }

        .resource-card {
            display: flex;
            gap: 15px;
            padding: 20px;
            border: 1px solid var(--border-color);
            border-radius: var(--radius);
            transition: var(--transition);
        }

        .resource-card:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow);
        }

        .resource-icon {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background-color: var(--primary-light);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--primary-color);
            font-size: 1.2rem;
        }

        .resource-details {
            flex: 1;
        }

        .resource-desc {
            color: var(--text-light);
            margin-bottom: 10px;
        }

        .resource-meta {
            display: flex;
            gap: 15px;
            font-size: 0.85rem;
            color: var(--text-light);
        }

        .resource-type {
            background-color: var(--primary-light);
            color: var(--primary-color);
            padding: 4px 8px;
            border-radius: 20px;
        }

        /* Enhanced Voice Controls */
        .voice-controls {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 800;
            display: flex;
            flex-direction: column;
            align-items: flex-end;
            gap: 10px;
        }

        .voice-btn {
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 50%;
            width: 60px;
            height: 60px;
            font-size: 1.5rem;
            cursor: pointer;
            box-shadow: var(--shadow);
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .voice-btn:hover {
            background-color: #5a52e0;
            transform: scale(1.05);
        }

        .voice-btn.listening {
            background-color: var(--danger-color);
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        .voice-feedback {
            background-color: var(--card-bg);
            padding: 15px;
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            max-width: 300px;
            display: none;
        }

        .voice-feedback.active {
            display: block;
        }

        .voice-commands {
            background-color: var(--primary-light);
            padding: 15px;
            border-radius: var(--radius);
            max-width: 300px;
            display: none;
        }

        .voice-commands.active {
            display: block;
        }

        .command-list {
            list-style: none;
            margin-top: 10px;
        }

        .command-item {
            padding: 8px 0;
            border-bottom: 1px solid var(--border-color);
            font-size: 0.9rem;
        }

        .command-item:last-child {
            border-bottom: none;
        }

        /* Accessibility Options */
        .accessibility-panel {
            position: fixed;
            top: 20px;
            left: 20px;
            z-index: 800;
        }

        .accessibility-toggle {
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            font-size: 1.2rem;
            cursor: pointer;
            box-shadow: var(--shadow);
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .accessibility-options {
            position: absolute;
            top: 60px;
            left: 0;
            background-color: var(--card-bg);
            padding: 20px;
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            width: 250px;
            display: none;
        }

        .accessibility-options.active {
            display: block;
        }

        .accessibility-option {
            margin-bottom: 15px;
        }

        .accessibility-option:last-child {
            margin-bottom: 0;
        }

        .accessibility-option label {
            display: flex;
            align-items: center;
            justify-content: space-between;
            cursor: pointer;
        }

        .switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 24px;
        }

        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 24px;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 16px;
            width: 16px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked + .slider {
            background-color: var(--primary-color);
        }

        input:checked + .slider:before {
            transform: translateX(26px);
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background-color: var(--card-bg);
            border-radius: var(--radius);
            padding: 30px;
            width: 90%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: var(--shadow);
        }

        .modal-actions {
            display: flex;
            gap: 15px;
            justify-content: flex-end;
            margin-top: 20px;
        }

        /* Contact Options */
        .contact-options {
            margin-bottom: 20px;
        }

        .contact-option {
            margin-bottom: 15px;
        }

        .contact-option input {
            display: none;
        }

        .contact-option label {
            display: flex;
            align-items: flex-start;
            gap: 15px;
            padding: 15px;
            border: 1px solid var(--border-color);
            border-radius: var(--radius);
            cursor: pointer;
            transition: var(--transition);
        }

        .contact-option input:checked + label {
            border-color: var(--primary-color);
            background-color: var(--primary-light);
        }

        .contact-option i {
            color: var(--primary-color);
            font-size: 1.5rem;
            margin-top: 5px;
        }

        .contact-option h3 {
            margin-bottom: 5px;
        }

        .contact-option p {
            color: var(--text-light);
            font-size: 0.9rem;
        }

        .contact-form {
            margin-bottom: 20px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        textarea {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid var(--border-color);
            border-radius: var(--radius);
            font-family: inherit;
            font-size: 1rem;
            transition: var(--transition);
            min-height: 100px;
            resize: vertical;
        }

        textarea:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 2px var(--primary-light);
        }

        input[type="text"] {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid var(--border-color);
            border-radius: var(--radius);
            font-family: inherit;
            font-size: 1rem;
            transition: var(--transition);
        }

        input[type="text"]:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 2px var(--primary-light);
        }

        .safety-check {
            display: flex;
            align-items: flex-start;
            gap: 10px;
            margin-bottom: 20px;
        }

        .safety-check input {
            margin-top: 5px;
        }

        .safety-check label {
            font-weight: normal;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .safety-check i {
            color: var(--success-color);
        }

        /* Location Services */
        .location-services {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 10px;
        }

        .location-btn {
            background-color: var(--primary-light);
            color: var(--primary-color);
            border: none;
            padding: 8px 12px;
            border-radius: var(--radius);
            cursor: pointer;
            font-weight: 600;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.9rem;
        }

        .location-btn:hover {
            background-color: var(--primary-color);
            color: white;
        }

        /* Map Section */
        .map-section {
            margin-top: 30px;
        }

        .map-container {
            height: 400px;
            border-radius: var(--radius);
            overflow: hidden;
            margin-top: 15px;
            border: 1px solid var(--border-color);
        }

        .map-controls {
            display: flex;
            gap: 15px;
            margin-top: 15px;
            flex-wrap: wrap;
        }

        /* Real-time Updates */
        .real-time-updates {
            margin-top: 30px;
            padding: 20px;
            background-color: var(--primary-light);
            border-radius: var(--radius);
        }

        .update-list {
            max-height: 200px;
            overflow-y: auto;
            margin-top: 15px;
        }

        .update-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px 0;
            border-bottom: 1px solid var(--border-color);
        }

        .update-item:last-child {
            border-bottom: none;
        }

        .update-icon {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background-color: var(--primary-color);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
        }

        .update-content {
            flex: 1;
        }

        .update-time {
            font-size: 0.8rem;
            color: var(--text-light);
        }

        /* Responsive */
        @media (max-width: 768px) {
            .search-filters {
                grid-template-columns: 1fr;
            }
            
            .search-actions {
                flex-direction: column;
            }
            
            .result-list {
                grid-template-columns: 1fr;
            }
            
            .result-actions {
                flex-direction: column;
                align-items: stretch;
            }
            
            .resource-cards {
                grid-template-columns: 1fr;
            }
            
            .ally-header {
                flex-direction: column;
                text-align: center;
            }
            
            .ally-actions {
                flex-direction: column;
            }
        }
    </style>
</head>
<body class="trauma-informed">
    <div class="emergency-exit">
        <a href="https://www.google.com" class="btn-emergency">
            <i class="fas fa-running"></i> Emergency Exit
        </a>
    </div>
    
    <!-- Accessibility Panel -->
    <div class="accessibility-panel">
        <button class="accessibility-toggle" id="accessibility-toggle" aria-label="Accessibility options">
            <i class="fas fa-universal-access"></i>
        </button>
        <div class="accessibility-options" id="accessibility-options">
            <div class="accessibility-option">
                <label>
                    High Contrast
                    <div class="switch">
                        <input type="checkbox" id="high-contrast">
                        <span class="slider"></span>
                    </div>
                </label>
            </div>
            <div class="accessibility-option">
                <label>
                    Larger Text
                    <div class="switch">
                        <input type="checkbox" id="larger-text">
                        <span class="slider"></span>
                    </div>
                </label>
            </div>
            <div class="accessibility-option">
                <label>
                    Reduced Motion
                    <div class="switch">
                        <input type="checkbox" id="reduced-motion">
                        <span class="slider"></span>
                    </div>
                </label>
            </div>
            <div class="accessibility-option">
                <label>
                    Voice Navigation
                    <div class="switch">
                        <input type="checkbox" id="voice-navigation" checked>
                        <span class="slider"></span>
                    </div>
                </label>
            </div>
        </div>
    </div>
    
    <!-- Enhanced Voice Controls -->
    <div class="voice-controls">
        <div class="voice-commands" id="voice-commands">
            <h4>Voice Commands</h4>
            <ul class="command-list">
                <li class="command-item"><strong>"Search protection order"</strong> - Find protection order specialists</li>
                <li class="command-item"><strong>"Find lawyers near me"</strong> - Use your location to find allies</li>
                <li class="command-item"><strong>"Show map"</strong> - View interactive map</li>
                <li class="command-item"><strong>"Clear search"</strong> - Reset all filters</li>
                <li class="command-item"><strong>"Help"</strong> - Show available commands</li>
            </ul>
        </div>
        
        <div class="voice-feedback" id="voice-feedback">
            <p>Listening...</p>
        </div>
        
        <button class="voice-btn" id="voice-btn" aria-label="Voice activation">
            <i class="fas fa-microphone"></i>
        </button>
    </div>
    
    <header class="app-header">
        <button class="menu-toggle" id="menu-toggle" aria-label="Toggle navigation menu">
            <span></span>
            <span></span>
            <span></span>
        </button>
        <h1>Justice Ally Finder</h1>
        <div class="user-actions">
            <button class="btn-icon" id="justice-help" aria-label="Help">
                <i class="fas fa-question-circle"></i>
            </button>
        </div>
    </header>
    
    <nav class="main-nav" id="main-nav">
        <ul>
            <li><a href="dashboard.html"><i class="fas fa-home"></i> Dashboard</a></li>
            <li><a href="empower-vault.html"><i class="fas fa-lock"></i> EmpowerVault</a></li>
            <li><a href="reclaim-path.html"><i class="fas fa-road"></i> ReclaimPath</a></li>
            <li><a href="community-pulse.html"><i class="fas fa-heartbeat"></i> Community Pulse</a></li>
            <li class="active"><a href="justice-ally.html"><i class="fas fa-balance-scale"></i> Justice Ally</a></li>
        </ul>
        
        <div class="nav-footer">
            <button class="btn-secondary" id="safety-center-btn">
                <i class="fas fa-shield-alt"></i> Safety Center
            </button>
            <div class="connection-status">
                <span class="status-indicator online" aria-label="Secure connection"></span>
                <span>Secure Connection</span>
            </div>
        </div>
    </nav>
    
    <main class="justice-container">
        <section class="justice-intro">
            <h2>Find Survivor-Informed Legal Support</h2>
            <p class="justice-description">Connect with lawyers, paralegals, and legal aid organizations that understand trauma and prioritize your safety.</p>
            
            <div class="safety-notice">
                <i class="fas fa-shield-alt"></i>
                <p>Your searches are private. No one will be notified unless you choose to contact them.</p>
            </div>
        </section>
        
        <section class="ally-search">
            <div class="search-card">
                <h3>What kind of support do you need?</h3>
                
                <div class="search-filters">
                    <div class="filter-group">
                        <label for="case-type">Case Type</label>
                        <select id="case-type">
                            <option value="">Select case type</option>
                            <option value="protection-order">Protection Order</option>
                            <option value="divorce">Divorce/Custody</option>
                            <option value="criminal">Criminal Case</option>
                            <option value="housing">Housing Rights</option>
                            <option value="employment">Employment Rights</option>
                            <option value="immigration">Immigration</option>
                            <option value="other">Other</option>
                        </select>
                    </div>
                    
                    <div class="filter-group">
                        <label for="location">Location</label>
                        <select id="location">
                            <option value="">Anywhere (remote)</option>
                            <option value="gauteng">Gauteng</option>
                            <option value="kzn">KwaZulu-Natal</option>
                            <option value="wc">Western Cape</option>
                            <option value="ec">Eastern Cape</option>
                            <option value="other">Other Province</option>
                        </select>
                        <div class="location-services">
                            <button class="location-btn" id="detect-location">
                                <i class="fas fa-location-arrow"></i> Use My Location
                            </button>
                        </div>
                    </div>
                    
                    <div class="filter-group">
                        <label for="language">Language</label>
                        <select id="language">
                            <option value="">Any language</option>
                            <option value="english">English</option>
                            <option value="zulu">isiZulu</option>
                            <option value="xhosa">isiXhosa</option>
                            <option value="afrikaans">Afrikaans</option>
                            <option value="sotho">Sesotho</option>
                        </select>
                    </div>
                    
                    <div class="filter-group">
                        <label for="cost">Cost</label>
                        <select id="cost">
                            <option value="">Any cost</option>
                            <option value="free">Free/Pro Bono</option>
                            <option value="sliding">Sliding Scale</option>
                            <option value="paid">Paid Services</option>
                        </select>
                    </div>
                </div>
                
                <div class="search-actions">
                    <button class="btn-primary" id="search-allies">
                        <i class="fas fa-search"></i> Find Allies
                    </button>
                    <button class="btn-secondary" id="voice-search-btn">
                        <i class="fas fa-microphone"></i> Voice Search
                    </button>
                </div>
            </div>
        </section>
        
        <!-- Real-time Updates Section -->
        <section class="real-time-updates">
            <h3>Real-time Updates</h3>
            <p>Live updates from allies in your area</p>
            
            <div class="update-list" id="update-list">
                <!-- Real-time updates will appear here -->
            </div>
        </section>
        
        <!-- Map Section -->
        <section class="map-section">
            <h3>Allies Near You</h3>
            <p>Interactive map showing available allies in your area</p>
            
            <div class="map-container" id="map-container">
                <!-- Map will be rendered here -->
            </div>
            
            <div class="map-controls">
                <button class="btn-secondary" id="refresh-map">
                    <i class="fas fa-sync-alt"></i> Refresh Map
                </button>
                <button class="btn-secondary" id="show-all-allies">
                    <i class="fas fa-eye"></i> Show All Allies
                </button>
                <button class="btn-secondary" id="filter-by-availability">
                    <i class="fas fa-user-clock"></i> Filter by Availability
                </button>
            </div>
        </section>
        
        <section class="ally-results">
            <h3>Recommended Legal Allies</h3>
            <p class="results-count">Showing <span id="results-count">8</span> results near you</p>
            
            <div class="result-list" id="result-list">
                <!-- Results will be populated here -->
            </div>
            
            <div class="result-actions">
                <button class="btn-secondary" id="load-more-results">
                    <i class="fas fa-chevron-down"></i> Load More
                </button>
                <button class="btn-text" id="save-search">
                    <i class="fas fa-bookmark"></i> Save This Search
                </button>
            </div>
        </section>
        
        <section class="ally-resources">
            <h3>Legal Resources</h3>
            
            <div class="resource-cards">
                <div class="resource-card">
                    <div class="resource-icon">
                        <i class="fas fa-file-alt"></i>
                    </div>
                    <div class="resource-details">
                        <h4>Step-by-Step: Applying for a Protection Order</h4>
                        <p class="resource-desc">What to expect, required documents, and how to prepare</p>
                        <div class="resource-meta">
                            <span class="resource-type">Guide</span>
                            <span class="resource-time">15 min read</span>
                        </div>
                    </div>
                    <button class="btn-icon">
                        <i class="fas fa-download"></i>
                    </button>
                </div>
                
                <div class="resource-card">
                    <div class="resource-icon">
                        <i class="fas fa-video"></i>
                    </div>
                    <div class="resource-details">
                        <h4>Video: Know Your Rights in the Workplace</h4>
                        <p class="resource-desc">Understanding sexual harassment policies and reporting</p>
                        <div class="resource-meta">
                            <span class="resource-type">Video</span>
                            <span class="resource-time">8 min</span>
                        </div>
                    </div>
                    <button class="btn-icon">
                        <i class="fas fa-play"></i>
                    </button>
                </div>
            </div>
        </section>
    </main>
    
    <!-- Contact Modal -->
    <div id="contact-modal" class="modal">
        <div class="modal-content">
            <h2>Contact <span id="ally-name">Legal Ally</span></h2>
            
            <div class="contact-options">
                <div class="contact-option">
                    <input type="radio" name="contact-method" id="contact-anon" checked>
                    <label for="contact-anon">
                        <i class="fas fa-user-secret"></i>
                        <div>
                            <h3>Anonymous Message</h3>
                            <p>Send a message without revealing your identity</p>
                        </div>
                    </label>
                </div>
                
                <div class="contact-option">
                    <input type="radio" name="contact-method" id="contact-identify">
                    <label for="contact-identify">
                        <i class="fas fa-id-card"></i>
                        <div>
                            <h3>Share My Contact Info</h3>
                            <p>Allow them to respond directly to you</p>
                        </div>
                    </label>
                </div>
                
                <div class="contact-option">
                    <input type="radio" name="contact-method" id="contact-referral">
                    <label for="contact-referral">
                        <i class="fas fa-handshake"></i>
                        <div>
                            <h3>Request Referral</h3>
                            <p>Ask for a referral to another trusted professional</p>
                        </div>
                    </label>
                </div>
            </div>
            
            <div class="contact-form">
                <div class="form-group">
                    <label for="contact-message">Your Message</label>
                    <textarea id="contact-message" placeholder="Briefly explain what you need help with..."></textarea>
                </div>
                
                <div class="form-group">
                    <label for="contact-urgency">Urgency Level</label>
                    <select id="contact-urgency">
                        <option value="standard">Standard (respond in 3-5 days)</option>
                        <option value="urgent">Urgent (within 24 hours)</option>
                        <option value="crisis">Crisis (immediate safety concern)</option>
                    </select>
                </div>
                
                <div class="form-group" id="contact-details-group" style="display: none;">
                    <label for="contact-details">Your Contact Information</label>
                    <input type="text" id="contact-details" placeholder="Email or phone number">
                </div>
            </div>
            
            <div class="safety-check">
                <input type="checkbox" id="safety-confirm">
                <label for="safety-confirm">
                    <i class="fas fa-check-circle"></i> I confirm that sharing this information is safe for me at this time
                </label>
            </div>
            
            <div class="modal-actions">
                <button class="btn-secondary" id="cancel-contact">
                    <i class="fas fa-times"></i> Cancel
                </button>
                <button class="btn-primary" id="send-contact">
                    <i class="fas fa-paper-plane"></i> Send Message
                </button>
            </div>
        </div>
    </div>
    
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
        // DOM Elements
        const menuToggle = document.getElementById('menu-toggle');
        const mainNav = document.getElementById('main-nav');
        const accessibilityToggle = document.getElementById('accessibility-toggle');
        const accessibilityOptions = document.getElementById('accessibility-options');
        const voiceBtn = document.getElementById('voice-btn');
        const voiceFeedback = document.getElementById('voice-feedback');
        const voiceCommands = document.getElementById('voice-commands');
        const voiceSearchBtn = document.getElementById('voice-search-btn');
        const searchAlliesBtn = document.getElementById('search-allies');
        const detectLocationBtn = document.getElementById('detect-location');
        const resultList = document.getElementById('result-list');
        const resultsCount = document.getElementById('results-count');
        const contactModal = document.getElementById('contact-modal');
        const cancelContactBtn = document.getElementById('cancel-contact');
        const sendContactBtn = document.getElementById('send-contact');
        const contactAnon = document.getElementById('contact-anon');
        const contactIdentify = document.getElementById('contact-identify');
        const contactDetailsGroup = document.getElementById('contact-details-group');
        const updateList = document.getElementById('update-list');
        const refreshMapBtn = document.getElementById('refresh-map');
        const showAllAlliesBtn = document.getElementById('show-all-allies');
        const filterByAvailabilityBtn = document.getElementById('filter-by-availability');
        
        // App State
        let userLocation = null;
        let map = null;
        let mapMarkers = [];
        let realTimeUpdates = [];
        let realTimeInterval = null;
        
        // Voice Recognition
        let recognition;
        let isListening = false;
        
        // Sample data for legal allies (with coordinates for mapping)
        const legalAllies = [
            {
                id: 1,
                name: "Women's Legal Centre",
                type: "organization",
                specialty: "Protection Orders, Divorce",
                location: "Cape Town, Johannesburg, Remote",
                languages: ["English", "isiXhosa", "Afrikaans"],
                rating: 4,
                reviews: 24,
                cost: "free",
                description: "A non-profit organization dedicated to advancing women's rights through strategic litigation and advocacy.",
                coordinates: [-33.9249, 18.4241], // Cape Town
                availability: "online",
                lastActive: new Date(Date.now() - 300000) // 5 minutes ago
            },
            {
                id: 2,
                name: "Adv. Thandi Nkosi",
                type: "lawyer",
                specialty: "Criminal Cases, Trauma-Informed",
                location: "Durban, Remote",
                languages: ["English", "isiZulu"],
                rating: 5,
                reviews: 18,
                cost: "sliding",
                description: "Specialized in criminal defense with a trauma-informed approach to supporting survivors.",
                coordinates: [-29.8587, 31.0218], // Durban
                availability: "in-person",
                lastActive: new Date(Date.now() - 600000) // 10 minutes ago
            },
            {
                id: 3,
                name: "Legal Aid South Africa",
                type: "organization",
                specialty: "Various Civil Matters",
                location: "Nationwide",
                languages: ["English", "isiZulu", "isiXhosa", "Afrikaans", "Sesotho"],
                rating: 4,
                reviews: 42,
                cost: "free",
                description: "Provides legal services to indigent people in civil and criminal matters.",
                coordinates: [-26.2041, 28.0473], // Johannesburg
                availability: "online",
                lastActive: new Date(Date.now() - 120000) // 2 minutes ago
            },
            {
                id: 4,
                name: "Adv. James Peterson",
                type: "lawyer",
                specialty: "Employment Rights, Discrimination",
                location: "Johannesburg, Remote",
                languages: ["English", "Afrikaans"],
                rating: 4,
                reviews: 15,
                cost: "paid",
                description: "Focuses on employment law with expertise in workplace discrimination and harassment cases.",
                coordinates: [-26.2041, 28.0473], // Johannesburg
                availability: "hybrid",
                lastActive: new Date(Date.now() - 1800000) // 30 minutes ago
            },
            {
                id: 5,
                name: "Survivor Support Network",
                type: "organization",
                specialty: "Trauma-Informed Advocacy",
                location: "Pretoria, Remote",
                languages: ["English", "Afrikaans", "Sesotho"],
                rating: 5,
                reviews: 32,
                cost: "free",
                description: "Peer-led organization providing trauma-informed legal advocacy and support.",
                coordinates: [-25.7479, 28.2293], // Pretoria
                availability: "online",
                lastActive: new Date(Date.now() - 90000) // 1.5 minutes ago
            }
        ];
        
        // Sample real-time updates
        const sampleUpdates = [
            "Adv. Thandi Nkosi is now available for immediate consultations",
            "Women's Legal Centre has extended their operating hours",
            "New pro bono legal clinic opening in your area next week",
            "Legal Aid South Africa now offering virtual consultations",
            "Survivor Support Network has new resources available"
        ];
        
        // Navigation Toggle
        menuToggle.addEventListener('click', () => {
            mainNav.classList.toggle('active');
        });
        
        // Accessibility Panel Toggle
        accessibilityToggle.addEventListener('click', () => {
            accessibilityOptions.classList.toggle('active');
        });
        
        // Initialize Voice Recognition
        function initializeVoiceRecognition() {
            if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
                recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
                recognition.continuous = false;
                recognition.interimResults = false;
                recognition.lang = 'en-US';
                
                recognition.onstart = function() {
                    isListening = true;
                    voiceBtn.classList.add('listening');
                    voiceFeedback.classList.add('active');
                    voiceFeedback.innerHTML = '<p>Listening... Speak now</p>';
                };
                
                recognition.onresult = function(event) {
                    const transcript = event.results[0][0].transcript;
                    voiceFeedback.innerHTML = `<p>You said: "${transcript}"</p>`;
                    
                    // Process voice commands
                    processVoiceCommand(transcript);
                    
                    setTimeout(() => {
                        voiceFeedback.classList.remove('active');
                    }, 5000);
                };
                
                recognition.onerror = function(event) {
                    voiceFeedback.innerHTML = `<p>Error: ${event.error}</p>`;
                    setTimeout(() => {
                        voiceFeedback.classList.remove('active');
                        voiceBtn.classList.remove('listening');
                        isListening = false;
                    }, 3000);
                };
                
                recognition.onend = function() {
                    voiceBtn.classList.remove('listening');
                    isListening = false;
                };
            } else {
                voiceBtn.disabled = true;
                voiceBtn.title = "Speech recognition not supported in this browser";
                voiceSearchBtn.disabled = true;
            }
        }
        
        // Process Voice Commands
        function processVoiceCommand(command) {
            const lowerCommand = command.toLowerCase();
            
            // Show commands list
            if (lowerCommand.includes('help') || lowerCommand.includes('commands')) {
                voiceCommands.classList.add('active');
                setTimeout(() => {
                    voiceCommands.classList.remove('active');
                }, 10000);
                return;
            }
            
            // Search commands
            if (lowerCommand.includes('search') || lowerCommand.includes('find')) {
                if (lowerCommand.includes('protection') || lowerCommand.includes('protection order')) {
                    document.getElementById('case-type').value = 'protection-order';
                    voiceFeedback.innerHTML += '<p>Searching for protection order specialists...</p>';
                } else if (lowerCommand.includes('divorce') || lowerCommand.includes('custody')) {
                    document.getElementById('case-type').value = 'divorce';
                    voiceFeedback.innerHTML += '<p>Searching for divorce and custody specialists...</p>';
                } else if (lowerCommand.includes('criminal')) {
                    document.getElementById('case-type').value = 'criminal';
                    voiceFeedback.innerHTML += '<p>Searching for criminal case specialists...</p>';
                } else if (lowerCommand.includes('employment') || lowerCommand.includes('work')) {
                    document.getElementById('case-type').value = 'employment';
                    voiceFeedback.innerHTML += '<p>Searching for employment rights specialists...</p>';
                } else if (lowerCommand.includes('housing')) {
                    document.getElementById('case-type').value = 'housing';
                    voiceFeedback.innerHTML += '<p>Searching for housing rights specialists...</p>';
                } else if (lowerCommand.includes('immigration')) {
                    document.getElementById('case-type').value = 'immigration';
                    voiceFeedback.innerHTML += '<p>Searching for immigration specialists...</p>';
                }
                
                // Execute search
                setTimeout(() => {
                    searchAllies();
                }, 1000);
            }
            
            // Location commands
            if (lowerCommand.includes('location') || lowerCommand.includes('near me') || lowerCommand.includes('my location')) {
                voiceFeedback.innerHTML += '<p>Finding allies near your location...</p>';
                detectLocationBtn.click();
            }
            
            // Map commands
            if (lowerCommand.includes('map') || lowerCommand.includes('show map')) {
                voiceFeedback.innerHTML += '<p>Showing interactive map...</p>';
                document.querySelector('.map-section').scrollIntoView({ behavior: 'smooth' });
            }
            
            // Clear commands
            if (lowerCommand.includes('clear') || lowerCommand.includes('reset')) {
                document.getElementById('case-type').value = '';
                document.getElementById('location').value = '';
                document.getElementById('language').value = '';
                document.getElementById('cost').value = '';
                voiceFeedback.innerHTML += '<p>Search filters cleared</p>';
            }
            
            // Emergency commands
            if (lowerCommand.includes('emergency') || lowerCommand.includes('help') || lowerCommand.includes('urgent')) {
                voiceFeedback.innerHTML += '<p>Opening emergency resources...</p>';
                document.querySelector('.btn-emergency').click();
            }
        }
        
        // Voice Button Handler
        voiceBtn.addEventListener('click', () => {
            if (!isListening) {
                recognition.start();
            } else {
                recognition.stop();
            }
        });
        
        voiceSearchBtn.addEventListener('click', () => {
            if (!isListening) {
                recognition.start();
            }
        });
        
        // Location Detection
        detectLocationBtn.addEventListener('click', () => {
            if (navigator.geolocation) {
                voiceFeedback.classList.add('active');
                voiceFeedback.innerHTML = '<p>Detecting your location...</p>';
                
                navigator.geolocation.getCurrentPosition(
                    (position) => {
                        const { latitude, longitude } = position.coords;
                        userLocation = { lat: latitude, lng: longitude };
                        
                        voiceFeedback.innerHTML = '<p>Location detected! Finding nearby legal allies...</p>';
                        setTimeout(() => {
                            voiceFeedback.classList.remove('active');
                        }, 3000);
                        
                        // Initialize map with user location
                        initializeMap(latitude, longitude);
                        
                        // Simulate finding nearby allies
                        document.getElementById('location').value = 'gauteng';
                        searchAllies();
                    },
                    (error) => {
                        console.error('Error getting location:', error);
                        voiceFeedback.innerHTML = '<p>Unable to detect your location. Please select manually.</p>';
                        setTimeout(() => {
                            voiceFeedback.classList.remove('active');
                        }, 3000);
                        
                        // Initialize map with default location
                        initializeMap(-26.2041, 28.0473); // Johannesburg
                    }
                );
            } else {
                alert('Geolocation is not supported by this browser.');
                // Initialize map with default location
                initializeMap(-26.2041, 28.0473); // Johannesburg
            }
        });
        
        // Initialize Map
        function initializeMap(lat, lng) {
            if (map) {
                map.remove();
                mapMarkers = [];
            }
            
            map = L.map('map-container').setView([lat, lng], 10);
            
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
            }).addTo(map);
            
            // Add user location marker
            const userMarker = L.marker([lat, lng])
                .addTo(map)
                .bindPopup('Your Location')
                .openPopup();
            
            mapMarkers.push(userMarker);
            
            // Add allies to map
            addAlliesToMap();
        }
        
        // Add Allies to Map
        function addAlliesToMap() {
            legalAllies.forEach(ally => {
                if (ally.coordinates) {
                    const marker = L.marker(ally.coordinates)
                        .addTo(map)
                        .bindPopup(`
                            <strong>${ally.name}</strong><br>
                            ${ally.specialty}<br>
                            ${ally.location}<br>
                            <button class="btn-small view-ally" data-id="${ally.id}">View Details</button>
                        `);
                    
                    mapMarkers.push(marker);
                }
            });
        }
        
        // Refresh Map
        refreshMapBtn.addEventListener('click', () => {
            if (userLocation) {
                initializeMap(userLocation.lat, userLocation.lng);
            } else {
                initializeMap(-26.2041, 28.0473); // Default to Johannesburg
            }
            
            // Simulate new allies appearing
            simulateNewAllies();
        });
        
        // Show All Allies
        showAllAlliesBtn.addEventListener('click', () => {
            if (map) {
                const group = new L.featureGroup(mapMarkers);
                map.fitBounds(group.getBounds().pad(0.1));
            }
        });
        
        // Filter by Availability
        filterByAvailabilityBtn.addEventListener('click', () => {
            // Filter allies by recent activity (last 15 minutes)
            const now = new Date();
            const fifteenMinutesAgo = new Date(now.getTime() - 15 * 60000);
            
            const availableAllies = legalAllies.filter(ally => 
                ally.lastActive > fifteenMinutesAgo
            );
            
            displayResults(availableAllies);
            
            // Update map to show only available allies
            if (map) {
                // Clear existing markers
                mapMarkers.forEach(marker => {
                    if (marker._popup && marker._popup._content) {
                        map.removeLayer(marker);
                    }
                });
                
                // Add only available allies
                availableAllies.forEach(ally => {
                    if (ally.coordinates) {
                        const marker = L.marker(ally.coordinates)
                            .addTo(map)
                            .bindPopup(`
                                <strong>${ally.name}</strong><br>
                                ${ally.specialty}<br>
                                ${ally.location}<br>
                                <button class="btn-small view-ally" data-id="${ally.id}">View Details</button>
                            `);
                        
                        mapMarkers.push(marker);
                    }
                });
            }
        });
        
        // Simulate New Allies (for demo purposes)
        function simulateNewAllies() {
            // Randomly add a new ally marker (for demo)
            if (Math.random() > 0.7 && userLocation) {
                const newLat = userLocation.lat + (Math.random() - 0.5) * 0.1;
                const newLng = userLocation.lng + (Math.random() - 0.5) * 0.1;
                
                const newMarker = L.marker([newLat, newLng])
                    .addTo(map)
                    .bindPopup(`
                        <strong>New Ally Available</strong><br>
                        Recently joined our network<br>
                        <button class="btn-small view-all-allies">View All Allies</button>
                    `)
                    .openPopup();
                
                mapMarkers.push(newMarker);
                
                // Add real-time update
                addRealTimeUpdate("New legal ally available in your area");
            }
        }
        
        // Real-time Updates
        function initializeRealTimeUpdates() {
            // Add initial updates
            sampleUpdates.forEach(update => {
                addRealTimeUpdate(update);
            });
            
            // Set up interval for new updates
            realTimeInterval = setInterval(() => {
                if (Math.random() > 0.7) {
                    const randomUpdate = sampleUpdates[Math.floor(Math.random() * sampleUpdates.length)];
                    addRealTimeUpdate(randomUpdate);
                }
            }, 30000); // Every 30 seconds
        }
        
        function addRealTimeUpdate(updateText) {
            const now = new Date();
            const timeString = now.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
            
            const updateItem = document.createElement('div');
            updateItem.className = 'update-item';
            updateItem.innerHTML = `
                <div class="update-icon">
                    <i class="fas fa-bell"></i>
                </div>
                <div class="update-content">
                    <p>${updateText}</p>
                    <div class="update-time">${timeString}</div>
                </div>
            `;
            
            updateList.insertBefore(updateItem, updateList.firstChild);
            
            // Limit to 5 updates
            if (updateList.children.length > 5) {
                updateList.removeChild(updateList.lastChild);
            }
            
            // Store update
            realTimeUpdates.unshift({
                text: updateText,
                time: now
            });
        }
        
        // Search Allies
        searchAlliesBtn.addEventListener('click', () => {
            searchAllies();
        });
        
        function searchAllies() {
            const caseType = document.getElementById('case-type').value;
            const location = document.getElementById('location').value;
            const language = document.getElementById('language').value;
            const cost = document.getElementById('cost').value;
            
            // Filter allies based on search criteria
            let filteredAllies = legalAllies;
            
            if (caseType) {
                filteredAllies = filteredAllies.filter(ally => 
                    ally.specialty.toLowerCase().includes(caseType.toLowerCase())
                );
            }
            
            if (location && location !== 'other') {
                filteredAllies = filteredAllies.filter(ally => 
                    ally.location.toLowerCase().includes(location.toLowerCase())
                );
            }
            
            if (language) {
                filteredAllies = filteredAllies.filter(ally => 
                    ally.languages.some(lang => 
                        lang.toLowerCase().includes(language.toLowerCase())
                    )
                );
            }
            
            if (cost) {
                filteredAllies = filteredAllies.filter(ally => 
                    ally.cost === cost
                );
            }
            
            // Update results count
            resultsCount.textContent = filteredAllies.length;
            
            // Display results
            displayResults(filteredAllies);
        }
        
        function displayResults(allies) {
            resultList.innerHTML = '';
            
            if (allies.length === 0) {
                resultList.innerHTML = `
                    <div class="no-results">
                        <i class="fas fa-search"></i>
                        <h4>No results found</h4>
                        <p>Try adjusting your search filters or use voice search for help.</p>
                    </div>
                `;
                return;
            }
            
            allies.forEach(ally => {
                const allyCard = document.createElement('div');
                allyCard.className = 'ally-card';
                
                // Generate star rating
                let stars = '';
                for (let i = 1; i <= 5; i++) {
                    if (i <= ally.rating) {
                        stars += '<i class="fas fa-star"></i>';
                    } else {
                        stars += '<i class="far fa-star"></i>';
                    }
                }
                
                // Generate language tags
                const languageTags = ally.languages.map(lang => 
                    `<span class="language-tag">${lang}</span>`
                ).join('');
                
                // Calculate time since last active
                const now = new Date();
                const timeDiff = now - ally.lastActive;
                const minutesAgo = Math.floor(timeDiff / 60000);
                let activityStatus = '';
                
                if (minutesAgo < 5) {
                    activityStatus = '<span style="color: var(--success-color);"><i class="fas fa-circle"></i> Online now</span>';
                } else if (minutesAgo < 30) {
                    activityStatus = `<span style="color: var(--warning-color);"><i class="fas fa-clock"></i> Active ${minutesAgo} min ago</span>`;
                } else {
                    activityStatus = `<span style="color: var(--text-light);"><i class="fas fa-clock"></i> Active earlier today</span>`;
                }
                
                allyCard.innerHTML = `
                    <div class="ally-header">
                        <div class="ally-photo">
                            <i class="fas fa-${ally.type === 'organization' ? 'building' : 'user-tie'}"></i>
                        </div>
                        <div class="ally-details">
                            <h4>${ally.name}</h4>
                            <p class="ally-specialty">Specializes in: ${ally.specialty}</p>
                            <div class="ally-location">
                                <i class="fas fa-map-marker-alt"></i>
                                <span>${ally.location}</span>
                            </div>
                            <div class="ally-languages">
                                ${languageTags}
                            </div>
                            <div class="ally-rating">
                                <div class="stars">
                                    ${stars}
                                </div>
                                <span class="review-count">${ally.reviews} survivor reviews</span>
                            </div>
                            <div class="ally-activity">
                                ${activityStatus}
                            </div>
                        </div>
                    </div>
                    <div class="ally-actions">
                        <button class="btn-small view-profile" data-id="${ally.id}">
                            <i class="fas fa-user-circle"></i> View Profile
                        </button>
                        <button class="btn-primary contact-ally" data-id="${ally.id}" data-name="${ally.name}">
                            <i class="fas fa-envelope"></i> Contact
                        </button>
                    </div>
                `;
                
                resultList.appendChild(allyCard);
            });
            
            // Add event listeners to contact buttons
            document.querySelectorAll('.contact-ally').forEach(button => {
                button.addEventListener('click', (e) => {
                    const allyId = e.target.closest('.contact-ally').getAttribute('data-id');
                    const allyName = e.target.closest('.contact-ally').getAttribute('data-name');
                    openContactModal(allyId, allyName);
                });
            });
        }
        
        // Contact Modal
        function openContactModal(allyId, allyName) {
            document.getElementById('ally-name').textContent = allyName;
            contactModal.classList.add('active');
        }
        
        cancelContactBtn.addEventListener('click', () => {
            contactModal.classList.remove('active');
        });
        
        // Show/hide contact details based on selection
        contactAnon.addEventListener('change', () => {
            contactDetailsGroup.style.display = 'none';
        });
        
        contactIdentify.addEventListener('change', () => {
            contactDetailsGroup.style.display = 'block';
        });
        
        // Send Contact Message
        sendContactBtn.addEventListener('click', () => {
            const message = document.getElementById('contact-message').value.trim();
            const urgency = document.getElementById('contact-urgency').value;
            const safetyConfirmed = document.getElementById('safety-confirm').checked;
            
            if (!safetyConfirmed) {
                alert('Please confirm that sharing this information is safe for you.');
                return;
            }
            
            if (!message) {
                alert('Please write a message to send.');
                return;
            }
            
            alert('Your message has been sent safely. You should receive a response within the selected timeframe.');
            contactModal.classList.remove('active');
            
            // Reset form
            document.getElementById('contact-message').value = '';
            document.getElementById('safety-confirm').checked = false;
            contactDetailsGroup.style.display = 'none';
            contactAnon.checked = true;
            
            // Add real-time update
            addRealTimeUpdate("Message sent to legal ally");
        });
        
        // Accessibility Options
        const highContrastToggle = document.getElementById('high-contrast');
        const largerTextToggle = document.getElementById('larger-text');
        const reducedMotionToggle = document.getElementById('reduced-motion');
        const voiceNavigationToggle = document.getElementById('voice-navigation');
        
        highContrastToggle.addEventListener('change', () => {
            document.body.classList.toggle('high-contrast', highContrastToggle.checked);
        });
        
        largerTextToggle.addEventListener('change', () => {
            document.body.classList.toggle('larger-text', largerTextToggle.checked);
        });
        
        reducedMotionToggle.addEventListener('change', () => {
            document.body.classList.toggle('reduced-motion', reducedMotionToggle.checked);
        });
        
        voiceNavigationToggle.addEventListener('change', () => {
            if (!voiceNavigationToggle.checked) {
                recognition.stop();
                voiceBtn.disabled = true;
                voiceSearchBtn.disabled = true;
            } else {
                voiceBtn.disabled = false;
                voiceSearchBtn.disabled = false;
            }
        });
        
        // Close modals when clicking outside
        window.addEventListener('click', (e) => {
            if (e.target === contactModal) {
                contactModal.classList.remove('active');
            }
        });
        
        // Initialize the app
        function initializeApp() {
            // Initialize voice recognition
            initializeVoiceRecognition();
            
            // Initialize with some results
            displayResults(legalAllies);
            
            // Initialize real-time updates
            initializeRealTimeUpdates();
            
            // Initialize map with default location
            initializeMap(-26.2041, 28.0473); // Johannesburg
            
            // Add a sample real-time update
            setTimeout(() => {
                addRealTimeUpdate("Welcome to Justice Ally Finder! We're here to help you find the right legal support.");
            }, 1000);
            
            // Show voice commands briefly on load
            setTimeout(() => {
                voiceCommands.classList.add('active');
                setTimeout(() => {
                    voiceCommands.classList.remove('active');
                }, 8000);
            }, 2000);
        }
        
        // Start the app
        initializeApp();
    </script>
</body>
</html>